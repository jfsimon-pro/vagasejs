<%- include('./header') %>
    <style>
        .editar-dados {
            margin-bottom: 12px;
        }

        .vagas-disponiveis h2 {
            color: white;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .vagas-disponiveis input {
            width: 55%;
            padding: 10px;
        }

        .vagas-disponiveis button {
            background: #F78E0F;
            color: white;
            border: none;
            font-size: 16px;
            padding: 10px 20px;
        }

        .pagination {
            display: flex;
            text-align: center;
            width: 100%;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .listavagas {
            display: flex;
            gap: 50px;
            justify-content: space-between;
            flex-direction: column;
        }

        .listavagas li {
            background: white;
            padding: 20px;
        }

        .listavagas h3 {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
        }

        .listavagas strong {
            font-weight: bold;
        }

        button {
            cursor: pointer;
        }

        .listavagas li p {
            margin-bottom: 7px;
        }

        .vagas-candidatadas h2 {
            color: white;
            font-weight: bold;
            font-size: 30px;
            margin-bottom: 25px;
        }

        .vagas-candidatadas li {
            background: white;
            padding: 20px;
        }

        .vagas-candidatadas ul {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .vagas-candidatadas h3 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .vagas-candidatadas strong {
            font-weight: bold;
        }

        .vagas-candidatadas p {
            margin-bottom: 10px;
        }

        .vagas-aprovadas li {
            background-color: white;
            padding: 20px;
        }

        .vagas-aprovadas h2 {
            color: white;
            font-weight: bold;
            font-size: 30px;
            margin-bottom: 25px;
            margin-top: 50px;
        }

        .vagas-aprovadas h3 {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 12px;
        }

        .vagas-aprovadas p {
            margin-bottom: 10px;
        }

        .vagas-aprovadas strong {
            font-weight: bold;
        }

        .vagas-aprovadas a {
            color: black;
        }

        /* Estilo para o botão de candidatura já realizada */
        .candidated {
            background: red !important;
            color: white;
            border: none;
            cursor: not-allowed;
        }
    </style>
    <style>
        .autocomplete-suggestions {
          border: 1px solid #ccc;
          max-height: 150px;
          overflow-y: auto;
          position: absolute;
          background-color: #fff;
          z-index: 1000;
        }
        .autocomplete-suggestions div {
          padding: 8px;
          cursor: pointer;
        }
        .autocomplete-suggestions div:hover {
          background-color: #f0f0f0;
        }
        .botoes-vagas-disponiveis {
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            gap: 20px;
        }
        .btn-info {
            color: black;
        }
        .vagas-disponiveis select {
            padding: 10px;
        }
        @media (max-width: 980px) {
            .vagas-disponiveis input {
                width: 95%;
            }
            .vagas-disponiveis form {
                margin-bottom: 20px;
                display: flex;
                flex-wrap: wrap;
                flex-direction: column;
            }
            .autocomplete-suggestions {
                position: unset;
            }
        }
      </style>
      
    <section class="candidato-superior">
        <div class="main-dashboard-candidato">
            <div class="vagas-disponiveis">
                <h2>Vagas Disponíveis</h2>
                <form action="/candidato/vagas" method="GET" style="margin-bottom: 20px;">
                    <!-- Barra de busca por palavra-chave -->
                    <input type="text" id="busca" name="busca" placeholder="Buscar vagas..." value="<%= busca || '' %>">
                    <div id="suggestions" class="autocomplete-suggestions"></div>

                
                    <!-- Filtro de faixa salarial -->
                    <select name="faixaSalarial">
                        <option value="">Selecione a faixa salarial</option>
                        <option value="Até 2.000" <%= faixaSalarial === 'Até 2.000' ? 'selected' : '' %>>Até 2.000</option>
                        <option value="A partir de R$ 2.000,00" <%= faixaSalarial === 'A partir de R$ 2.000,00' ? 'selected' : '' %>>A partir de R$ 2.000,00</option>
                        <option value="A partir de R$ 3.000,00" <%= faixaSalarial === 'A partir de R$ 3.000,00' ? 'selected' : '' %>>A partir de R$ 3.000,00</option>
                        <option value="A partir de R$ 4.000,00" <%= faixaSalarial === 'A partir de R$ 4.000,00' ? 'selected' : '' %>>A partir de R$ 4.000,00</option>
                        <option value="A partir de R$ 5.000,00" <%= faixaSalarial === 'A partir de R$ 5.000,00' ? 'selected' : '' %>>A partir de R$ 5.000,00</option>
                        <option value="A partir de R$ 6.000,00" <%= faixaSalarial === 'A partir de R$ 6.000,00' ? 'selected' : '' %>>A partir de R$ 6.000,00</option>
                        <option value="A partir de R$ 7.000,00" <%= faixaSalarial === 'A partir de R$ 7.000,00' ? 'selected' : '' %>>A partir de R$ 7.000,00</option>
                        <option value="A partir de R$ 8.000,00" <%= faixaSalarial === 'A partir de R$ 8.000,00' ? 'selected' : '' %>>A partir de R$ 8.000,00</option>
                        <option value="A partir de R$ 9.000,00" <%= faixaSalarial === 'A partir de R$ 9.000,00' ? 'selected' : '' %>>A partir de R$ 9.000,00</option>
                        <option value="A partir de R$ 10.000,00" <%= faixaSalarial === 'A partir de R$ 10.000,00' ? 'selected' : '' %>>A partir de R$ 10.000,00</option>
                        <option value="A partir de R$ 15.000,00" <%= faixaSalarial === 'A partir de R$ 15.000,00' ? 'selected' : '' %>>A partir de R$ 15.000,00</option>
                        <option value="A partir de R$ 20.000,00" <%= faixaSalarial === 'A partir de R$ 20.000,00' ? 'selected' : '' %>>A partir de R$ 20.000,00</option>
                    </select>
                
                    <!-- Filtro de tipo de contrato -->
                    <select name="tipoContrato">
                        <option value="">Selecione o tipo de contrato</option>
                        <option value="CLT" <%= tipoContrato === 'CLT' ? 'selected' : '' %>>CLT</option>
                        <option value="PJ" <%= tipoContrato === 'PJ' ? 'selected' : '' %>>PJ</option>
                        <option value="Estágio" <%= tipoContrato === 'Estágio' ? 'selected' : '' %>>Estágio</option>
                        <option value="Temporário" <%= tipoContrato === 'Temporário' ? 'selected' : '' %>>Temporário</option>
                        <option value="Autônomo" <%= tipoContrato === 'Autônomo' ? 'selected' : '' %>>Autônomo</option>
                        <option value="Freelancer" <%= tipoContrato === 'Freelancer' ? 'selected' : '' %>>Freelancer</option>
                        <option value="Aprendiz" <%= tipoContrato === 'Aprendiz' ? 'selected' : '' %>>Aprendiz</option>
                    </select>
                
                    <!-- Botão de buscar -->
                    <button type="submit">Buscar</button>
                </form>
                

                <% if (vagasDisponiveis.length> 0) { %>
                    <ul class="listavagas">
                        <% vagasDisponiveis.forEach(vaga=> { %>
                            <li>
                                <h3>
                                    <%= vaga.titulo %>
                                </h3>
                                <p><strong>Descrição:</strong>
                                    <%= vaga.descricao %>
                                </p>
                                <p><strong>Cargo/Função:</strong>
                                    <%= vaga.cargo %>
                                </p>
                                <p><strong>Salário:</strong>
                                    <%= vaga.faixaSalarial %>
                                </p>
                                <div class="botoes-vagas-disponiveis">
                                    <form action="/candidato/candidatar" method="POST">
                                        <input type="hidden" name="vagaId" value="<%= vaga.id %>">
                                        <% if (vagasCandidatadasIds.includes(vaga.id)) { %>
                                          <button type="button" class="btn btn-secondary candidated" disabled>Já Candidatado</button>
                                        <% } else { %>
                                          <button type="submit" class="btn btn-primary">Candidatar-se</button>
                                        <% } %>
                                      </form>
                                      <a href="/candidato/vagas/<%= vaga.id %>/detalhes" class="btn btn-info">Ver mais detalhes</a>
                                </div>
                            </li>
                            <% }); %>
                    </ul>

                    <nav>
                        <ul class="pagination">
                            <% for (let i=1; i <=totalPages; i++) { %>
                                <li class="<%= i === currentPage ? 'active' : '' %>">
                                    <a href="/candidato/vagas?page=<%= i %>&busca=<%= busca %>">
                                        <%= i %>
                                    </a>
                                </li>
                                <% } %>
                        </ul>
                    </nav>
                    <% } else { %>
                        <p>Nenhuma vaga disponível.</p>
                        <% } %>
            </div>
        </div>
    </section>

    <script src="/js/autocomplete.js"></script>

    <%- include('../partials/footer') %>